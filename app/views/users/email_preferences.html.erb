<%# Breadcrumb Navigation %>
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <%= link_to "Home", root_path, class: "text-decoration-none" %>
    </li>
    <li class="breadcrumb-item">
      <%= link_to "Profile", user_path, class: "text-decoration-none" %>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Email Preferences</li>
  </ol>
</nav>

<%# Action Buttons %>
<div class="d-flex gap-2 mb-3">
  <%= link_to user_path, class: "btn btn-secondary me-2" do %>
    <i class="fas fa-arrow-left me-1"></i>
    Back to Profile
  <% end %>
</div>

<%# Header Card %>
<div class="card bg-primary text-white shadow-sm mb-4">
  <div class="card-body text-center py-4">
    <h1 class="card-title mb-2">
      <i class="fas fa-envelope me-2"></i>
      Email Preferences
    </h1>
    <p class="card-text mb-0">Manage your notification settings for <%= @user.first_name %> <%= @user.last_name %></p>
  </div>
</div>

<%# Main Content %>
<div class="row">
  <div class="mx-auto">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h3 class="card-title mb-0">
          <i class="fas fa-bell me-2 text-warning"></i>
          Notification Settings
        </h3>
      </div>
      <div class="card-body">
        <p class="text-muted mb-4">
          Choose which email notifications you'd like to receive. You can update these preferences at any time.
        </p>

        <%= form_with url: update_email_preferences_user_path, method: :patch, local: true, class: "needs-validation", novalidate: true do |form| %>
          <div class="row">
            <% EmailSubscription.subscription_types.each do |type_key, type_value| %>
              <% subscription = @user.email_subscriptions.find_by(subscription_type: type_key) %>
              <% is_enabled = subscription&.enabled || false %>

              <div class="col-12 mb-3">
                <div class="form-check form-switch">
                  <%= check_box_tag "email_subscriptions[#{type_key}]", "1", is_enabled,
                      class: "form-check-input",
                      id: "subscription_#{type_key}" %>
                  <%= label_tag "subscription_#{type_key}", class: "form-check-label" do %>
                    <strong><%= subscription_type_title(type_key) %></strong>
                    <br>
                    <small class="text-muted"><%= subscription_type_description(type_key) %></small>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>

          <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
            <%= form.submit "Update Preferences", class: "btn btn-primary btn-lg px-4" %>
          </div>
        <% end %>
      </div>
    </div>

    <%# Information Card %>
    <div class="card mt-4 border-warning">
      <div class="card-header bg-warning bg-opacity-10">
        <h5 class="card-title mb-0 text-warning">
          <i class="fas fa-info-circle me-2"></i>
          Important Information
        </h5>
      </div>
      <div class="card-body">
        <ul class="mb-0">
          <li><strong>Event Notifications:</strong> Stay informed about new events, cancellations, and changes to club meetings.</li>
          <li><strong>Student Notifications:</strong> Receive updates when your linked students' attendance or profile information is updated.</li>
          <li><strong>Account Notifications:</strong> Get notified when students are added to or removed from your account.</li>
          <li><strong>Email Delivery:</strong> Notifications are sent immediately when events occur.</li>
        </ul>
      </div>
    </div>
  </div>
</div>