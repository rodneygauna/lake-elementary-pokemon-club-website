<% content_for :title, "My Profile - #{current_user.full_name}" %>

<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <%= link_to "Home", root_path, class: "text-decoration-none" %>
    </li>
    <li class="breadcrumb-item active" aria-current="page">My Profile</li>
  </ol>
</nav>

<!-- Action Buttons (Before Header) -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <%= link_to root_path, class: "btn btn-outline-secondary me-2" do %>
      <i class="fas fa-arrow-left me-1"></i>Back to Home
    <% end %>
    <%= link_to edit_user_path, class: "btn btn-outline-primary me-2" do %>
      <i class="fas fa-edit me-1"></i>Edit Profile
    <% end %>
    <%= link_to email_preferences_user_path, class: "btn btn-outline-warning me-2" do %>
      <i class="fas fa-envelope me-1"></i>Email Preferences
    <% end %>
  </div>
</div>

<!-- Header Card -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-primary text-white">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <i class="fas fa-user-circle me-2"></i>
        <h1 class="h4 mb-0">My Profile</h1>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge bg-light text-dark me-2">
          <i class="fas fa-user-check me-1"></i>Your Account
        </span>
        <% if current_user.admin? %>
          <span class="badge bg-warning text-dark">
            <i class="fas fa-shield-alt me-1"></i><%= current_user.role_display_name %>
          </span>
        <% elsif current_user.super_user? %>
          <span class="badge bg-success text-white">
            <i class="fas fa-user-friends me-1"></i><%= current_user.role_display_name %>
          </span>
        <% else %>
          <span class="badge bg-light text-dark">
            <i class="fas fa-user me-1"></i><%= current_user.role_display_name %>
          </span>
        <% end %>
      </div>
    </div>
  </div>
  <div class="card-body">
    <p class="text-muted mb-0">
      <i class="fas fa-info-circle me-1"></i>
      Manage your personal information and view your linked students.
    </p>
  </div>
</div>

<!-- User Information Card -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="text-dark border-bottom pb-2 mb-4">
      <i class="fas fa-address-card me-2"></i>Personal Information
    </h5>

    <div class="row g-3">
      <div class="col-12 col-md-6">
        <div class="p-3 rounded" style="background-color: #f8f9fa;">
          <h6 class="text-muted mb-1">
            <i class="fas fa-user me-1"></i>Full Name
          </h6>
          <div class="fw-bold text-dark">
            <%= current_user.full_name %>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="p-3 rounded" style="background-color: #f8f9fa;">
          <h6 class="text-muted mb-1">
            <i class="fas fa-envelope me-1"></i>Email Address
          </h6>
          <div class="fw-bold text-dark">
            <%= current_user.email_address %>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="p-3 rounded" style="background-color: #f8f9fa;">
          <h6 class="text-muted mb-1">
            <i class="fas fa-phone me-1"></i>Phone Number
          </h6>
          <div class="fw-bold text-dark">
            <% if current_user.phone_number.present? %>
              <%= current_user.phone_number %>
            <% else %>
              <span class="text-muted">Not provided</span>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="p-3 rounded" style="background-color: #f8f9fa;">
          <h6 class="text-muted mb-1">
            <i class="fas fa-shield-alt me-1"></i>Account Role
          </h6>
          <div class="fw-bold text-dark">
            <% if current_user.admin? %>
              <span class="text-warning fw-medium">
                <i class="fas fa-shield-alt me-1"></i>Administrator
              </span>
            <% else %>
              <span class="text-muted fw-medium">
                <i class="fas fa-user me-1"></i>User
              </span>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="p-3 rounded" style="background-color: #f8f9fa;">
          <h6 class="text-muted mb-1">
            <i class="fas fa-user-check me-1"></i>Account Status
          </h6>
          <div class="fw-bold text-dark">
            <% if current_user.status == "active" %>
              <span class="text-success fw-medium">
                <i class="fas fa-check-circle me-1"></i>Active
              </span>
            <% elsif current_user.status == "inactive" %>
              <span class="text-warning fw-medium">
                <i class="fas fa-pause-circle me-1"></i>Inactive
              </span>
            <% elsif current_user.status == "suspended" %>
              <span class="text-danger fw-medium">
                <i class="fas fa-ban me-1"></i>Suspended
              </span>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="p-3 rounded" style="background-color: #f8f9fa;">
          <h6 class="text-muted mb-1">
            <i class="fas fa-calendar-plus me-1"></i>Member Since
          </h6>
          <div class="fw-bold text-dark">
            <%= current_user.created_at.strftime("%B %d, %Y") %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- My Students Card -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="text-dark border-bottom pb-2 mb-4">
      <i class="fas fa-users me-2"></i>My Students
    </h5>

    <% if current_user.students.any? %>
      <div class="row g-3">
        <% current_user.students.each do |student| %>
          <div class="col-12 col-md-6">
            <div class="p-3 rounded border" style="background-color: var(--pokemon-light-blue);">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="text-dark mb-1">
                    <i class="fas fa-user-circle me-1"></i>
                    <%= student.display_name_for(current_user) %>
                  </h6>
                  <div class="text-muted small mb-2">
                    <i class="fas fa-graduation-cap me-1"></i>
                    <% case student.grade %>
                    <% when "kindergarten_grade" %>
                      Kindergarten
                    <% when "first_grade" %>
                      1st Grade
                    <% when "second_grade" %>
                      2nd Grade
                    <% when "third_grade" %>
                      3rd Grade
                    <% when "fourth_grade" %>
                      4th Grade
                    <% when "fifth_grade" %>
                      5th Grade
                    <% when "sixth_grade" %>
                      6th Grade
                    <% else %>
                      Grade <%= student.grade %>
                    <% end %>
                  </div>
                  <% if student.favorite_pokemon.present? %>
                    <div class="text-dark small">
                      <i class="fas fa-heart text-warning me-1"></i>
                      Favorite: <%= student.favorite_pokemon %>
                    </div>
                  <% end %>
                  <div class="mt-2">
                    <% if student.status == "active" %>
                      <span class="text-success fw-medium small">
                        <i class="fas fa-check-circle me-1"></i>Active Member
                      </span>
                    <% else %>
                      <span class="text-warning fw-medium small">
                        <i class="fas fa-pause-circle me-1"></i><%= student.status.titleize %>
                      </span>
                    <% end %>
                  </div>
                </div>
                <div class="text-end">
                  <%= link_to student_path(student), class: "btn btn-sm btn-outline-primary" do %>
                    <i class="fas fa-eye me-1"></i>View
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="mt-3 pt-3 border-top">
        <div class="d-flex justify-content-between align-items-center">
          <div class="text-muted small">
            <i class="fas fa-info-circle me-1"></i>
            You are linked to <%= pluralize(current_user.students.count, 'student') %> as their parent or guardian.
          </div>
          <div>
            <%= link_to students_path, class: "btn btn-sm btn-outline-secondary" do %>
              <i class="fas fa-users me-1"></i>View All Students
            <% end %>
          </div>
        </div>
      </div>
    <% else %>
      <div class="text-center py-4">
        <i class="fas fa-users fa-3x text-muted mb-3"></i>
        <h6 class="text-muted">No Linked Students</h6>
        <p class="text-muted mb-3">
          You are not currently linked to any students as a parent or guardian.
          Contact a club administrator to link student accounts to your profile.
        </p>
        <div>
          <%= link_to students_path, class: "btn btn-outline-primary btn-sm" do %>
            <i class="fas fa-users me-1"></i>View All Students
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>