<div class="card border-0 shadow-sm h-100">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="flex-grow-1">
        <!-- Event Title and Badges -->
        <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
          <h5 class="card-title mb-0">
            <%= link_to event.title, event, class: "text-decoration-none", style: "color: #0084FF;" %>
          </h5>

          <!-- Status Badges -->
          <% if event.status == 'canceled' %>
            <span class="badge bg-danger">
              <i class="bi bi-x-circle me-1"></i>Cancelled
            </span>
          <% elsif event.status == 'draft' %>
            <span class="badge bg-secondary">
              <i class="bi bi-eye-slash me-1"></i>Draft
            </span>
          <% end %>

          <!-- Special Event Badge -->
          <% if event.special? %>
            <span class="badge" style="background-color: #FFD700; color: #000;">
              <i class="bi bi-star-fill me-1"></i>Special Event
            </span>
          <% end %>
        </div>

        <!-- Event Description -->
        <% if event.description.present? %>
          <p class="card-text text-muted mb-3">
            <%= truncate(event.description, length: 120) %>
          </p>
        <% end %>
      </div>
    </div>

    <!-- Event Details -->
    <div class="row g-3 mb-3">
      <!-- Date & Time -->
      <div class="col-12 col-md-6">
        <div class="d-flex align-items-center text-muted">
          <i class="bi bi-calendar3 me-2" style="color: #0084FF;"></i>
          <div>
            <strong class="d-block" style="color: #333;">
              <%= event.starts_at.in_time_zone(event.time_zone).strftime("%A, %B %d") %>
            </strong>
            <small>
              <%= event.starts_at.in_time_zone(event.time_zone).strftime("%I:%M %p") %> -
              <%= event.ends_at.in_time_zone(event.time_zone).strftime("%I:%M %p") %>
              <span class="text-muted">(<%= event.time_zone.split('/').last.gsub('_', ' ') %>)</span>
            </small>
          </div>
        </div>
      </div>

      <!-- Venue (if present) -->
      <% if event.venue.present? %>
        <div class="col-12 col-md-6">
          <div class="d-flex align-items-center text-muted">
            <i class="bi bi-geo-alt me-2" style="color: #0084FF;"></i>
            <div>
              <strong class="d-block" style="color: #333;"><%= event.venue %></strong>
              <% if event.city.present? && event.state.present? %>
                <small><%= event.city %>, <%= event.state %></small>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Countdown Timer -->
    <% if event.starts_at > Time.current %>
      <div class="alert alert-info py-2 mb-3">
        <i class="bi bi-clock me-2"></i>
        <span id="countdown-<%= event.id %>">
          <script>
            (function() {
              const eventDate = new Date('<%= event.starts_at.iso8601 %>');
              const countdownElement = document.getElementById('countdown-<%= event.id %>');

              function updateCountdown() {
                const now = new Date();
                const diff = eventDate - now;

                if (diff <= 0) {
                  countdownElement.innerHTML = '<strong>Event has started!</strong>';
                  return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                if (days > 0) {
                  countdownElement.innerHTML = `<strong>Starts in ${days} day${days > 1 ? 's' : ''}</strong>`;
                } else if (hours > 0) {
                  countdownElement.innerHTML = `<strong>Starts in ${hours} hour${hours > 1 ? 's' : ''}</strong>`;
                } else {
                  countdownElement.innerHTML = `<strong>Starts in ${minutes} minute${minutes > 1 ? 's' : ''}</strong>`;
                }
              }

              updateCountdown();
              setInterval(updateCountdown, 60000); // Update every minute
            })();
          </script>
        </span>
      </div>
    <% elsif event.starts_at <= Time.current && event.ends_at >= Time.current %>
      <div class="alert alert-success py-2 mb-3">
        <i class="bi bi-broadcast me-2"></i>
        <strong>Happening now!</strong>
      </div>
    <% end %>

    <!-- Action Buttons -->
    <div class="d-flex flex-wrap gap-2">
      <%= link_to event, class: "btn btn-outline-primary btn-sm d-flex align-items-center gap-1" do %>
        <i class="bi bi-eye"></i> View Details
      <% end %>

      <% if current_user&.admin? %>
        <%= link_to edit_event_path(event), class: "btn btn-outline-secondary btn-sm d-flex align-items-center gap-1" do %>
          <i class="bi bi-pencil"></i> Edit
        <% end %>
      <% end %>
    </div>
  </div>
</div>