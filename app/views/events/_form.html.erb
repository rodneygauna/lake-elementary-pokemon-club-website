<%= form_with(model: event, local: true, class: "needs-validation", novalidate: true) do |form| %>
  <div class="row">
    <div class="col-12">
      <% if event.errors.any? %>
        <div class="alert alert-danger mb-4">
          <h5 class="alert-heading">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <%= pluralize(event.errors.count, "error") %> prohibited this event from being saved:
          </h5>
          <ul class="mb-0">
            <% event.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Basic Event Information -->
  <div class="row mb-4">
    <div class="col-12">
      <h5 class="text-dark border-bottom pb-2 mb-3">
        <i class="fas fa-info-circle me-2"></i>Basic Information
      </h5>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <!-- Title -->
        <div class="col-12">
          <%= form.label :title, class: "form-label fw-bold" do %>
            Event Title <span class="text-danger">*</span>
          <% end %>
          <%= form.text_field :title, class: "form-control", placeholder: "e.g., Pokemon Club Meeting", required: true %>
          <div class="invalid-feedback">Please provide a valid event title.</div>
        </div>

        <!-- Description -->
        <div class="col-12">
          <%= form.label :description, class: "form-label fw-bold" %>
          <%= form.text_area :description, class: "form-control", rows: 4,
              placeholder: "Describe what will happen at this event..." %>
          <div class="form-text">Provide details about the event activities, agenda, or special instructions.</div>
        </div>

        <!-- Status and Special Event -->
        <div class="col-12 col-md-6">
          <%= form.label :status, class: "form-label fw-bold" do %>
            Status <span class="text-danger">*</span>
          <% end %>
          <%= form.select :status,
              options_for_select([
                ['Draft', 'draft'],
                ['Published', 'published'],
                ['Cancelled', 'canceled']
              ], event.status),
              { prompt: 'Select status...' },
              { class: "form-select", required: true } %>
          <div class="form-text">Draft events are only visible to admins.</div>
        </div>

        <div class="col-12 col-md-6 d-flex align-items-end">
          <div class="form-check form-switch">
            <%= form.check_box :special, class: "form-check-input", style: "transform: scale(1.2);" %>
            <%= form.label :special, class: "form-check-label fw-bold ms-2" do %>
              <i class="fas fa-star me-1 text-warning"></i>
              Special Event
            <% end %>
            <div class="form-text mt-1">Mark this as a special event (not a regular meeting)</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Date & Time -->
  <div class="row mb-4 mt-4">
    <div class="col-12">
      <h5 class="text-dark border-bottom pb-2 mb-3">
        <i class="fas fa-clock me-2"></i>Date & Time
      </h5>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <!-- Start Date/Time -->
        <div class="col-12 col-md-6">
          <%= form.label :starts_at, class: "form-label fw-bold" do %>
            Start Date & Time <span class="text-danger">*</span>
          <% end %>
          <%
            # For editing, show the time in the event's timezone
            starts_at_value = if event.persisted? && event.starts_at.present? && event.time_zone.present?
              event.starts_at.in_time_zone(event.time_zone).strftime("%Y-%m-%dT%H:%M")
            elsif event.starts_at.present?
              event.starts_at.strftime("%Y-%m-%dT%H:%M")
            else
              nil
            end
          %>
          <%= form.datetime_local_field :starts_at,
              class: "form-control",
              required: true,
              value: starts_at_value %>
        </div>

        <!-- End Date/Time -->
        <div class="col-12 col-md-6">
          <%= form.label :ends_at, class: "form-label fw-bold" do %>
            End Date & Time <span class="text-danger">*</span>
          <% end %>
          <%
            # For editing, show the time in the event's timezone
            ends_at_value = if event.persisted? && event.ends_at.present? && event.time_zone.present?
              event.ends_at.in_time_zone(event.time_zone).strftime("%Y-%m-%dT%H:%M")
            elsif event.ends_at.present?
              event.ends_at.strftime("%Y-%m-%dT%H:%M")
            else
              nil
            end
          %>
          <%= form.datetime_local_field :ends_at,
              class: "form-control",
              required: true,
              value: ends_at_value %>
        </div>

        <!-- Time Zone -->
        <div class="col-12">
          <%= form.label :time_zone, class: "form-label fw-bold" %>
          <%= form.select :time_zone,
              options_for_select([
                ['Pacific Time - Los Angeles', 'America/Los_Angeles'],
                ['Mountain Time - Denver', 'America/Denver'],
                ['Central Time - Chicago', 'America/Chicago'],
                ['Eastern Time - New York', 'America/New_York']
              ], event.time_zone || 'America/Los_Angeles'),
              {},
              { class: "form-select" } %>
          <div class="form-text">
            <i class="fas fa-info-circle me-1"></i>
            Enter the start and end times above in this timezone. The system will automatically convert them for storage and display.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Location Information -->
  <div class="row mb-4 mt-4">
    <div class="col-12">
      <h5 class="text-dark border-bottom pb-2 mb-3">
        <i class="fas fa-map-marker-alt me-2"></i>Location <span class="text-muted">(Optional)</span>
      </h5>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <!-- Venue Name -->
        <div class="col-12">
          <%= form.label :venue, class: "form-label fw-bold" %>
          <%= form.text_field :venue, class: "form-control",
              placeholder: "e.g., Lake Elementary School Library" %>
        </div>

        <!-- Address -->
        <div class="col-12">
          <%= form.label :address1, "Address Line 1", class: "form-label fw-bold" %>
          <%= form.text_field :address1, class: "form-control",
              placeholder: "Street address" %>
        </div>

        <div class="col-12">
          <%= form.label :address2, "Address Line 2", class: "form-label fw-bold" %>
          <%= form.text_field :address2, class: "form-control",
              placeholder: "Apartment, suite, unit, building, floor, etc." %>
        </div>

        <!-- City, State, ZIP -->
        <div class="col-12 col-md-5">
          <%= form.label :city, class: "form-label fw-bold" %>
          <%= form.text_field :city, class: "form-control", placeholder: "City" %>
        </div>

        <div class="col-12 col-md-3">
          <%= form.label :state, class: "form-label fw-bold" %>
          <%= form.text_field :state, class: "form-control", placeholder: "State" %>
        </div>

        <div class="col-12 col-md-4">
          <%= form.label :zipcode, "ZIP Code", class: "form-label fw-bold" %>
          <%= form.text_field :zipcode, class: "form-control", placeholder: "12345" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Actions -->
  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
    <%= form.submit event.persisted? ? "Update Event" : "Create Event",
        class: "btn btn-primary btn-lg px-4" %>
  </div>
<% end %>


