<% content_for :title, "Students" %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 text-primary fw-bold">
          <i class="bi bi-mortarboard-fill me-2"></i>Club Students
        </h1>
        <% if admin? %>
          <%= link_to new_student_path, class: "btn btn-primary" do %>
            <i class="bi bi-plus-circle me-1"></i>Add New Student
          <% end %>
        <% end %>
      </div>

      <% if @students.any? %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-primary">
              <tr>
                <th scope="col">
                  <i class="bi bi-person me-1"></i>Name
                </th>
                <th scope="col">
                  <i class="bi bi-trophy me-1"></i>Grade
                </th>
                <th scope="col">
                  <i class="bi bi-star me-1"></i>Favorite Pok√©mon
                </th>
                <th scope="col">
                  <i class="bi bi-activity me-1"></i>Status
                </th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @students.each do |student| %>
                <tr>
                  <td class="fw-semibold">
                    <%= student.display_name_for(current_user) %>
                  </td>
                  <td>
                    <span class="badge bg-secondary">
                      <%= student.grade.titleize %>
                    </span>
                  </td>
                  <td>
                    <span class="text-primary fw-medium">
                      <%= student.favorite_pokemon %>
                    </span>
                  </td>
                  <td>
                    <% if student.status == "active" %>
                      <span class="badge bg-success">
                        <i class="bi bi-check-circle me-1"></i>Active
                      </span>
                    <% else %>
                      <span class="badge bg-warning">
                        <i class="bi bi-pause-circle me-1"></i><%= student.status.titleize %>
                      </span>
                    <% end %>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <%= link_to student, class: "btn btn-outline-primary btn-sm" do %>
                        <i class="bi bi-eye me-1"></i>View
                      <% end %>

                      <% if admin? || (current_user && student.users.include?(current_user)) %>
                        <%= link_to edit_student_path(student), class: "btn btn-outline-secondary btn-sm" do %>
                          <i class="bi bi-pencil me-1"></i>Edit
                        <% end %>
                      <% end %>

                      <% if admin? %>
                        <%= form_with model: student, method: :delete, local: true, class: "d-inline" do |form| %>
                          <button type="button"
                                  class="btn btn-outline-danger btn-sm"
                                  data-bs-toggle="modal"
                                  data-bs-target="#confirmationModal"
                                  data-confirm-title="Delete Student"
                                  data-confirm-message="Are you sure you want to delete <%= student.display_name_for(current_user) %>? This action cannot be undone."
                                  data-confirm-action="Delete Student">
                            <i class="bi bi-trash me-1"></i>Delete
                          </button>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-mortarboard text-muted" style="font-size: 4rem;"></i>
          <h4 class="text-muted mt-3">No students found</h4>
          <p class="text-muted">Check back later for club members!</p>
        </div>
      <% end %>

    </div>
  </div>
</div>

<%= render "shared/generic_confirmation_modal" %>