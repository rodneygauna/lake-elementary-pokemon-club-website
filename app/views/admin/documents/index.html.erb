<% content_for :title, "Document Management" %>

<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <%= link_to "Home", root_path, class: "text-decoration-none" %>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Document Management</li>
  </ol>
</nav>

<!-- Action Buttons (Before Header) -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <%= link_to root_path, class: "btn btn-outline-secondary me-2" do %>
      <i class="fas fa-arrow-left me-1"></i>Back to Home
    <% end %>
  </div>
  <div>
    <%= link_to new_admin_document_path, class: "btn btn-success" do %>
      <i class="fas fa-plus me-2"></i>Add New Document
    <% end %>
  </div>
</div>

<!-- Header Card -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-primary text-white">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <i class="fas fa-folder-open me-2"></i>
        <h1 class="h4 mb-0">Document Management</h1>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge bg-light text-dark">
          <i class="fas fa-file-alt me-1"></i>
          <%= pluralize(@documents.count, 'Document') %>
        </span>
      </div>
    </div>
  </div>
  <div class="card-body">
    <p class="text-muted mb-0">
      <i class="fas fa-info-circle me-1"></i>
      Manage documents, links, and files for the public resources page.
    </p>
  </div>
</div>

<!-- Filter Controls -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center">
      <h6 class="text-dark mb-0">
        <i class="fas fa-filter me-2"></i>Filter Options
      </h6>
      <div class="d-flex align-items-center">
        <%= form_with url: admin_documents_path, method: :get, local: true, class: "d-flex align-items-center" do |form| %>
          <%= form.select :document_type,
                         options_for_select([['All Types', ''], ['External Links', 'link'], ['File Downloads', 'file']], params[:document_type]),
                         {},
                         { class: "form-select form-select-sm", onchange: "this.form.submit()" } %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Statistics Dashboard -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h6 class="text-dark border-bottom pb-2 mb-3">
      <i class="fas fa-chart-bar me-2"></i>Document Statistics
    </h6>
    <div class="row text-center">
      <div class="col-md-4 col-6 mb-3">
        <div class="p-3 rounded" style="background-color: var(--pokemon-light-blue);">
          <i class="fas fa-file-alt fa-2x text-dark mb-2"></i>
          <div class="fw-bold text-dark fs-4"><%= @documents.count %></div>
          <small class="text-muted">Total Documents</small>
        </div>
      </div>
      <div class="col-md-4 col-6 mb-3">
        <div class="p-3 rounded" style="background-color: var(--pokemon-light-yellow);">
          <i class="fas fa-external-link-alt fa-2x text-dark mb-2"></i>
          <div class="fw-bold text-dark fs-4"><%= @documents.links.count %></div>
          <small class="text-muted">External Links</small>
        </div>
      </div>
      <div class="col-md-4 col-6 mb-3">
        <div class="p-3 rounded" style="background-color: var(--pokemon-light-blue);">
          <i class="fas fa-calendar fa-2x text-dark mb-2"></i>
          <div class="fw-bold text-dark fs-4"><%= @documents.count > 0 ? @documents.maximum(:created_at)&.strftime("%b %Y") : "N/A" %></div>
          <small class="text-muted">Latest Added</small>
        </div>
      </div>
    </div>

    <!-- Second Row: File Type Breakdown -->
    <% if @documents.files.any? %>
      <div class="row text-center">
        <div class="col-md-4 col-6 mb-3">
          <div class="p-3 rounded" style="background-color: #e7f3ff;">
            <i class="fas fa-image fa-2x text-success mb-2"></i>
            <div class="fw-bold text-dark fs-4"><%= @documents.files.select(&:is_image?).count %></div>
            <small class="text-muted">Image Files</small>
          </div>
        </div>
        <div class="col-md-4 col-6 mb-3">
          <div class="p-3 rounded" style="background-color: #fff2e7;">
            <i class="fas fa-file-pdf fa-2x text-danger mb-2"></i>
            <div class="fw-bold text-dark fs-4">
              <%= @documents.files.count { |doc| doc.file_extension&.downcase == 'pdf' } %>
            </div>
            <small class="text-muted">PDF Documents</small>
          </div>
        </div>
        <div class="col-md-4 col-12 mb-3">
          <div class="p-3 rounded" style="background-color: #f0fff0;">
            <i class="fas fa-file-alt fa-2x text-info mb-2"></i>
            <div class="fw-bold text-dark fs-4">
              <%= @documents.files.count { |doc| !doc.is_image? && doc.file_extension&.downcase != 'pdf' } %>
            </div>
            <small class="text-muted">Other Files</small>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Documents Table -->
<div class="card shadow-sm">
  <div class="card-body p-0">
    <% if @documents.any? %>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead style="background: linear-gradient(135deg, var(--pokemon-electric-blue) 0%, #0066CC 100%); color: white;">
            <tr>
              <th scope="col" class="border-0">
                <i class="fas fa-file-alt me-1"></i>Document Name
              </th>
              <th scope="col" class="border-0">
                <i class="fas fa-tag me-1"></i>Type
              </th>
              <th scope="col" class="border-0">
                <i class="fas fa-info-circle me-1"></i>Details
              </th>
              <th scope="col" class="border-0">
                <i class="fas fa-calendar me-1"></i>Created
              </th>
              <th scope="col" class="border-0">
                <i class="fas fa-user me-1"></i>Created By
              </th>
              <th scope="col" class="border-0">
                <i class="fas fa-cogs me-1"></i>Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <% @documents.each do |document| %>
              <tr>
                <td class="fw-semibold text-dark">
                  <% if document.link? %>
                    <i class="fas fa-external-link-alt me-2 text-primary"></i>
                  <% elsif document.is_image? %>
                    <i class="fas fa-image me-2 text-success"></i>
                  <% else %>
                    <i class="fas fa-file me-2 text-info"></i>
                  <% end %>
                  <%= document.display_name %>
                  <% if document.description.present? %>
                    <div class="small text-muted mt-1">
                      <%= truncate(document.description, length: 80) %>
                    </div>
                  <% end %>
                </td>
                <td>
                  <% if document.link? %>
                    <span class="badge bg-primary">
                      <i class="fas fa-external-link-alt me-1"></i>External Link
                    </span>
                  <% elsif document.is_image? %>
                    <span class="badge bg-success">
                      <i class="fas fa-image me-1"></i>Image File
                    </span>
                  <% else %>
                    <span class="badge bg-info">
                      <i class="fas fa-file me-1"></i>Document File
                    </span>
                  <% end %>
                </td>
                <td class="text-dark">
                  <% if document.link? %>
                    <div class="small">
                      <i class="fas fa-link me-1 text-primary"></i>
                      <%= truncate(document.url, length: 40) %>
                    </div>
                  <% else %>
                    <div class="small">
                      <% if document.file_attachment.attached? %>
                        <span class="badge bg-secondary me-1"><%= document.file_extension&.upcase || "FILE" %></span>
                        <%= number_to_human_size(document.file_size) %>
                      <% else %>
                        <span class="text-danger">No file attached</span>
                      <% end %>
                    </div>
                  <% end %>
                </td>
                <td class="text-dark">
                  <div class="small">
                    <i class="fas fa-calendar me-1 text-muted"></i>
                    <%= document.created_at.strftime("%b %d, %Y") %>
                  </div>
                  <div class="small text-muted">
                    <%= time_ago_in_words(document.created_at) %> ago
                  </div>
                </td>
                <td>
                  <div class="small">
                    <i class="fas fa-user me-1 text-muted"></i>
                    <%= document.created_by.full_name %>
                  </div>
                </td>
                <td>
                  <%= link_to admin_document_path(document), class: "btn btn-sm btn-outline-primary me-1" do %>
                    <i class="fas fa-eye me-1"></i>View
                  <% end %>
                  <%= link_to edit_admin_document_path(document), class: "btn btn-sm btn-outline-secondary me-1" do %>
                    <i class="fas fa-edit me-1"></i>Edit
                  <% end %>
                  <% if current_user.can_delete? %>
                    <% form_id = "delete-document-#{document.id}-form" %>
                    <%= form_with model: [:admin, document], method: :delete, local: true, class: "d-inline", id: form_id do |form| %>
                      <button type="button"
                              class="btn btn-sm btn-outline-danger"
                              data-bs-toggle="modal"
                              data-bs-target="#confirmationModal"
                              data-confirm-title="Delete Document"
                              data-confirm-message="Are you sure you want to delete <%= document.display_name %>? This action cannot be undone."
                              data-confirm-action="Delete Document"
                              data-form-id="<%= form_id %>">
                        <i class="fas fa-trash me-1"></i>Delete
                      </button>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">No Documents Found</h5>
        <p class="text-muted mb-3">
          <% if params[:document_type].present? %>
            No documents match your current filters. Try adjusting your search criteria.
          <% else %>
            Start building your resources page by adding documents and links.
          <% end %>
        </p>
        <%= link_to new_admin_document_path, class: "btn btn-success" do %>
          <i class="fas fa-plus me-2"></i>Add First Document
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<!-- Confirmation Modal -->
<%= render "shared/generic_confirmation_modal" %>