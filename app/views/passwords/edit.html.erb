<% content_for :title, "Update Password" %>

<!-- Hero Section -->
<div class="card shadow-sm mb-4" style="background: linear-gradient(135deg, var(--pokemon-electric-blue) 0%, #0066CC 100%);">
  <div class="card-body py-4 text-center text-white">
    <i class="fas fa-lock fs-1 text-warning mb-3"></i>
    <h1 class="h3 mb-2">Update Your Password</h1>
    <p class="mb-0">Create a new secure password for your account</p>
  </div>
</div>

<!-- Flash Messages -->
<% if flash[:alert] %>
  <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <%= flash[:alert] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>

<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
    <i class="fas fa-check-circle me-2"></i>
    <%= flash[:notice] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>

<!-- Password Update Form -->
<div class="card shadow-sm">
  <div class="card-header bg-primary text-white">
    <div class="d-flex align-items-center">
      <i class="fas fa-key me-2"></i>
      <h2 class="h5 mb-0">Set New Password</h2>
    </div>
  </div>
  <div class="card-body p-4">
    <%= form_with url: password_path(params[:token]), method: :put, local: true, class: "needs-validation", novalidate: true do |form| %>
      <!-- New Password Field -->
      <div class="mb-3">
        <%= form.label :password, class: "form-label text-dark fw-medium" do %>
          <i class="fas fa-lock me-1 text-muted"></i>New Password
        <% end %>
        <%= form.password_field :password,
                                required: true,
                                autofocus: true,
                                autocomplete: "new-password",
                                placeholder: "Enter your new password",
                                maxlength: 72,
                                minlength: 8,
                                class: "form-control form-control-lg" %>
        <div class="invalid-feedback">
          Password must be at least 8 characters long.
        </div>
        <div class="form-text text-muted">
          <i class="fas fa-info-circle me-1"></i>
          Choose a strong password with at least 8 characters.
        </div>
      </div>
ciqr0glYGAKB
      <!-- Confirm Password Field -->
      <div class="mb-4">
        <%= form.label :password_confirmation, class: "form-label text-dark fw-medium" do %>
          <i class="fas fa-lock me-1 text-muted"></i>Confirm New Password
        <% end %>
        <%= form.password_field :password_confirmation,
                                required: true,
                                autocomplete: "new-password",
                                placeholder: "Confirm your new password",
                                maxlength: 72,
                                minlength: 8,
                                class: "form-control form-control-lg" %>
        <div class="invalid-feedback">
          Please confirm your password.
        </div>
        <div class="form-text text-muted">
          <i class="fas fa-check me-1"></i>
          Re-enter your password to confirm it matches.
        </div>
      </div>

      <!-- Update Password Button -->
      <div class="d-grid mb-3">
        <%= form.submit "Update Password", class: "btn btn-success btn-lg" %>
      </div>
    <% end %>

    <!-- Back to Sign In Link -->
    <div class="text-center">
      <small class="text-muted">Changed your mind?</small><br>
      <%= link_to new_session_path, class: "text-decoration-none" do %>
        <i class="fas fa-arrow-left me-1"></i>Back to Sign In
      <% end %>
    </div>
  </div>
</div>

<!-- Security Tips Card -->
<div class="card shadow-sm mt-4">
  <div class="card-body text-center py-4" style="background-color: var(--pokemon-light-yellow);">
    <i class="fas fa-shield-alt fs-4 text-warning mb-2"></i>
    <h5 class="text-dark mb-3">Password Security Tips</h5>
    <div class="row g-3 text-start">
      <div class="col-md-4">
        <div class="d-flex align-items-start">
          <i class="fas fa-check text-success me-2 mt-1"></i>
          <small class="text-muted">Use at least 8 characters</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex align-items-start">
          <i class="fas fa-check text-success me-2 mt-1"></i>
          <small class="text-muted">Include letters and numbers</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex align-items-start">
          <i class="fas fa-check text-success me-2 mt-1"></i>
          <small class="text-muted">Make it unique and memorable</small>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Bootstrap form validation with password confirmation check
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        // Custom password confirmation validation
        var password = form.querySelector('input[name="password"]');
        var passwordConfirmation = form.querySelector('input[name="password_confirmation"]');

        if (password.value !== passwordConfirmation.value) {
          passwordConfirmation.setCustomValidity('Passwords do not match');
        } else {
          passwordConfirmation.setCustomValidity('');
        }

        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);

      // Real-time password confirmation validation
      var passwordConfirmation = form.querySelector('input[name="password_confirmation"]');
      if (passwordConfirmation) {
        passwordConfirmation.addEventListener('input', function() {
          var password = form.querySelector('input[name="password"]');
          if (password.value !== passwordConfirmation.value) {
            passwordConfirmation.setCustomValidity('Passwords do not match');
          } else {
            passwordConfirmation.setCustomValidity('');
          }
        });
      }
    });
  }, false);
})();
</script>
